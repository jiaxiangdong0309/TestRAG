# 搜索页面需求文档

## 页面概述
本页面是搜索页面，采用左右分栏布局设计。

## 页面布局
- **左侧**：聊天功能区域
- **右侧**：内容展示区域（iframe，预留位置）

## 左侧聊天功能区域

### 1. 聊天记录框（上半部分）

#### 1.1 聊天记录结构
每条聊天记录包含以下元素：
- **头像**：位于左侧
- **用户输入文本**：位于右侧
- **机器人回复文本**：位于左侧 使用流式文本展示

#### 1.2 头像设计
- 使用圆形头像
- **用户头像**：蓝色背景，显示"用户"文案
- **机器人头像**：绿色背景，显示"机器"文案

#### 1.3 聊天内容样式
- **用户发送内容**：白色背景
- **机器人回复内容**：灰色背景

### 2. 功能按钮区域（中间部分）

#### 2.1 联网搜索开关
- **功能**：控制是否开启联网搜索功能
- **状态**：可点击切换，开启时显示绿色，关闭时显示灰色
- **显示**：动态显示"联网搜索已开启"或"联网搜索已关闭"

#### 2.2 清空聊天记录
- **功能**：清空聊天记录框中的所有记录
- **状态**：始终可点击

#### 2.3 生成网页
- **功能**：点击后调用聊天接口，设置 `is_create_html: 1` 参数，生成网页内容
- **状态**：可点击，点击后调用聊天接口

### 3. 输入框区域（下半部分）

#### 3.1 输入框规格
- 高度：80px
- 超出内容时支持上下滚动

#### 3.2 发送功能
- 包含发送按钮
- 点击发送后自动清空输入框
- 输入框无内容时，发送按钮不可点击
- 点击发送后 调用dify的流式接口 将用户输入的文本发送给后端 后端返回流式文本 前端实时展示

## 右侧展示区域

### 内容展示
- 使用 iframe 展示生成的内容
- 功能：可以使用iframe展示html内容

## 技术实现要点

### 聊天接口集成
- **接口类型**: 使用 Dify SSE 流式聊天接口
- **接口调用**: `difyApi.quick.stream()` 或 `difyApi.quick.chatStream()`
- **响应模式**: 流式响应 (`response_mode: "streaming"`)
- **用户标识**: 固定用户ID (`user: "abc-123"`)
- **新增字段**:
  - **history_message**: 历史消息，将当前历史对话消息以JSON形式传递
  - **is_search_web**: 是否开启联网搜索，枚举值为 0（不开启）/ 1（开启）
  - **is_create_html**: 是否生成网页，枚举值为 0（不生成）/ 1（生成），点击"生成网页"按钮时设置为 1

### 流式响应处理
- **实时文本更新**: 通过 `onTextChunk` 回调实时显示机器人回复
- **完整事件追踪**: 监控聊天流程的各个阶段
- **错误处理**: 完善的错误捕获和用户提示
- **状态管理**: 自动管理发送状态和结果状态

### 状态管理
- 聊天记录状态管理
- 输入框内容状态管理
- 按钮可用性状态管理
- 流式响应状态管理

### 交互逻辑
- 发送消息流程
- 清空记录流程
- 输入验证逻辑
- 流式内容展示逻辑

### 样式设计
- 响应式布局
- 聊天记录滚动
- 输入框自适应高度
- 流式文本动画效果





